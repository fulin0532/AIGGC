import{r as m,g as y}from"./phaser-DFK5Ua9d.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function t(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=t(s);fetch(s.href,a)}})();var w=m();const o=y(w);class S extends o.Scene{constructor(){super({key:"BootScene"})}preload(){const e=this.add.graphics(),t=this.add.graphics();t.fillStyle(2236962,.8),t.fillRect(440,320,400,50);const i=this.cameras.main.width,s=this.cameras.main.height,a=this.make.text({x:i/2,y:s/2-50,text:"加载中...",style:{font:"20px monospace",fill:"#ffffff"}});a.setOrigin(.5,.5);const r=this.make.text({x:i/2,y:s/2+15,text:"0%",style:{font:"18px monospace",fill:"#ffffff"}});r.setOrigin(.5,.5),this.load.on("progress",c=>{r.setText(parseInt(c*100)+"%"),e.clear(),e.fillStyle(16777215,1),e.fillRect(450,330,380*c,30)}),this.load.on("complete",()=>{e.destroy(),t.destroy(),a.destroy(),r.destroy()}),this.createPlaceholderAssets()}createPlaceholderAssets(){const e=this.add.graphics();e.fillStyle(65280,1),e.fillRect(0,0,32,32),e.generateTexture("player",32,32),e.destroy();const t=this.add.graphics();t.fillStyle(16776960,1),t.fillCircle(4,4,4),t.generateTexture("bullet",8,8),t.destroy();const i=this.add.graphics();i.fillStyle(16711680,1),i.fillRect(0,0,28,28),i.generateTexture("zombie",28,28),i.destroy();const s=this.add.graphics();s.fillStyle(16737792,1),s.fillRect(0,0,24,24),s.generateTexture("runner",24,24),s.destroy();const a=this.add.graphics();a.fillStyle(6684672,1),a.fillRect(0,0,40,40),a.generateTexture("tank",40,40),a.destroy();const r=this.add.graphics();r.fillStyle(8913151,1),r.fillRect(0,0,64,64),r.generateTexture("boss",64,64),r.destroy();const c=this.add.graphics();c.fillStyle(65535,1),c.fillCircle(6,6,6),c.generateTexture("xp",12,12),c.destroy()}create(){this.scene.start("MenuScene")}}class v extends o.Scene{constructor(){super({key:"MenuScene"})}create(){const e=this.cameras.main.width,t=this.cameras.main.height;this.add.text(e/2,t/3,"ROGUELIKE SHOOTER",{font:"64px monospace",fill:"#ffffff",stroke:"#000000",strokeThickness:4}).setOrigin(.5),this.add.text(e/2,t/3+80,"肉鸽射击游戏",{font:"24px monospace",fill:"#cccccc"}).setOrigin(.5);const a=this.add.text(e/2,t/2+50,"开始游戏",{font:"32px monospace",fill:"#00ff00",backgroundColor:"#003300",padding:{x:20,y:10}});a.setOrigin(.5),a.setInteractive({useHandCursor:!0}),a.on("pointerover",()=>{a.setStyle({fill:"#ffffff",backgroundColor:"#00ff00"})}),a.on("pointerout",()=>{a.setStyle({fill:"#00ff00",backgroundColor:"#003300"})}),a.on("pointerdown",()=>{this.scene.start("GameScene")});const r=this.getSaveData();r.highScore>0&&this.add.text(e/2,t/2+150,`最高分: ${r.highScore}`,{font:"24px monospace",fill:"#ffff00"}).setOrigin(.5),this.add.text(e/2,t-100,"WASD - 移动 | 自动射击最近的敌人",{font:"18px monospace",fill:"#888888"}).setOrigin(.5)}getSaveData(){const e=localStorage.getItem("roguelikeShooterSave");return e?JSON.parse(e):{highScore:0,unlockedWeapons:["pistol"]}}}const h={width:1280,height:720,player:{speed:200,maxHealth:100,baseAttack:10,attackSpeed:1},weapons:{pistol:{name:"手枪",damage:15,fireRate:500,projectileSpeed:400,range:500},rifle:{name:"步枪",damage:10,fireRate:200,projectileSpeed:600,range:600},shotgun:{name:"霰弹枪",damage:8,fireRate:800,projectileSpeed:300,range:300,pellets:5}},enemies:{zombie:{name:"僵尸",health:30,speed:80,damage:10,score:10,xp:5},runner:{name:"奔跑者",health:20,speed:150,damage:5,score:15,xp:8},tank:{name:"坦克",health:100,speed:50,damage:20,score:50,xp:20}},boss:{name:"恶魔领主",health:500,speed:120,damage:25,score:500,xp:100},waves:{baseEnemyCount:5,enemyIncrement:3,bossInterval:5,spawnInterval:2e3},levelUp:{baseXP:20,xpMultiplier:1.5},upgrades:{healthBoost:{name:"生命提升",description:"最大生命值+20",effect:{maxHealth:20}},speedBoost:{name:"速度提升",description:"移动速度+15%",effect:{speed:1.15}},damageBoost:{name:"伤害提升",description:"攻击力+20%",effect:{damage:1.2}},attackSpeedBoost:{name:"攻速提升",description:"攻击速度+25%",effect:{attackSpeed:1.25}},newWeapon:{name:"新武器",description:"解锁一把新武器",effect:{newWeapon:!0}}}};class B extends o.Physics.Arcade.Sprite{constructor(e,t,i){super(e,t,i,"player"),e.add.existing(this),e.physics.add.existing(this),this.scene=e,this.maxHealth=h.player.maxHealth,this.health=this.maxHealth,this.speed=h.player.speed,this.attackPower=h.player.baseAttack,this.attackSpeed=h.player.attackSpeed,this.level=1,this.xp=0,this.xpToNextLevel=h.levelUp.baseXP,this.weapons=["pistol"],this.currentWeapon="pistol",this.lastFireTime=0,this.kills=0,this.setCollideWorldBounds(!0),this.setScale(1),this.cursors=e.input.keyboard.addKeys({w:o.Input.Keyboard.KeyCodes.W,a:o.Input.Keyboard.KeyCodes.A,s:o.Input.Keyboard.KeyCodes.S,d:o.Input.Keyboard.KeyCodes.D})}update(e,t){this.handleMovement(),this.autoShoot(e,t)}handleMovement(){const e=new o.Math.Vector2(0,0);this.cursors.w.isDown?e.y=-1:this.cursors.s.isDown&&(e.y=1),this.cursors.a.isDown?e.x=-1:this.cursors.d.isDown&&(e.x=1),e.normalize(),e.scale(this.speed),this.setVelocity(e.x,e.y)}autoShoot(e,t){const i=h.weapons[this.currentWeapon],s=i.fireRate/this.attackSpeed;if(e-this.lastFireTime<s)return;const a=this.findNearestEnemy(t);if(!a)return;o.Math.Distance.Between(this.x,this.y,a.x,a.y)<=i.range&&(this.shoot(a),this.lastFireTime=e)}findNearestEnemy(e){let t=null,i=1/0;return e.getChildren().forEach(s=>{if(!s.active)return;const a=o.Math.Distance.Between(this.x,this.y,s.x,s.y);a<i&&(i=a,t=s)}),t}shoot(e){const t=h.weapons[this.currentWeapon],i=o.Math.Angle.Between(this.x,this.y,e.x,e.y);if(t.pellets)for(let s=0;s<t.pellets;s++){const a=(Math.random()-.5)*.4;this.createBullet(i+a,t)}else this.createBullet(i,t)}createBullet(e,t){const i=this.scene.bullets.get(this.x,this.y,"bullet");i&&i.fire(e,t,this.attackPower)}takeDamage(e){this.health-=e,this.setTint(16711680),this.scene.time.delayedCall(100,()=>{this.clearTint()}),this.health<=0&&this.die()}heal(e){this.health=Math.min(this.health+e,this.maxHealth)}gainXP(e){this.xp+=e,this.xp>=this.xpToNextLevel&&this.levelUp()}levelUp(){this.level++,this.xp-=this.xpToNextLevel,this.xpToNextLevel=Math.floor(h.levelUp.baseXP*Math.pow(h.levelUp.xpMultiplier,this.level-1)),this.scene.showLevelUpUI()}applyUpgrade(e){const t=e.effect;if(t.maxHealth&&(this.maxHealth+=t.maxHealth,this.health+=t.maxHealth),t.speed&&(this.speed*=t.speed),t.damage&&(this.attackPower*=t.damage),t.attackSpeed&&(this.attackSpeed*=t.attackSpeed),t.newWeapon){const i=Object.keys(h.weapons).filter(s=>!this.weapons.includes(s));if(i.length>0){const s=o.Utils.Array.GetRandom(i);this.weapons.push(s)}}}die(){this.setActive(!1),this.setVisible(!1),this.scene.gameOver()}}class g extends o.Physics.Arcade.Sprite{constructor(e,t,i,s){const a=s==="boss"?h.boss:h.enemies[s],r=s==="boss"?"boss":s;super(e,t,i,r),e.add.existing(this),e.physics.add.existing(this),this.scene=e,this.type=s,this.config=a,this.maxHealth=a.health,this.health=this.maxHealth,this.speed=a.speed,this.damage=a.damage,this.score=a.score,this.xpValue=a.xp,this.lastAttackTime=0,this.attackCooldown=1e3,this.setCollideWorldBounds(!0),this.createHealthBar()}createHealthBar(){const e=this.width,t=4,i=-this.height/2-8;this.healthBarBg=this.scene.add.graphics(),this.healthBarBg.fillStyle(0,.5),this.healthBarBg.fillRect(this.x-e/2,this.y+i,e,t),this.healthBar=this.scene.add.graphics(),this.updateHealthBar()}updateHealthBar(){if(!this.healthBar)return;const e=this.width,t=4,i=-this.height/2-8,s=this.health/this.maxHealth,a=s>.5?65280:s>.25?16776960:16711680;this.healthBar.clear(),this.healthBar.fillStyle(a,1),this.healthBar.fillRect(this.x-e/2,this.y+i,e*s,t),this.healthBarBg&&(this.healthBarBg.clear(),this.healthBarBg.fillStyle(0,.5),this.healthBarBg.fillRect(this.x-e/2,this.y+i,e,t))}update(e,t){if(!this.active||!t.active)return;this.moveTowardsPlayer(t),this.updateHealthBar(),o.Math.Distance.Between(this.x,this.y,t.x,t.y)<40&&e-this.lastAttackTime>this.attackCooldown&&(this.attack(t),this.lastAttackTime=e)}moveTowardsPlayer(e){const t=o.Math.Angle.Between(this.x,this.y,e.x,e.y);this.setVelocity(Math.cos(t)*this.speed,Math.sin(t)*this.speed)}attack(e){e.takeDamage(this.damage)}takeDamage(e){this.health-=e,this.updateHealthBar(),this.setTint(16711680),this.scene.time.delayedCall(100,()=>{this.clearTint()}),this.health<=0&&this.die()}die(){this.scene.spawnXP(this.x,this.y,this.xpValue),this.scene.addScore(this.score),this.healthBar&&(this.healthBar.destroy(),this.healthBar=null),this.healthBarBg&&(this.healthBarBg.destroy(),this.healthBarBg=null),this.scene.tweens.add({targets:this,alpha:0,duration:200,onComplete:()=>{this.destroy()}})}destroy(){this.healthBar&&this.healthBar.destroy(),this.healthBarBg&&this.healthBarBg.destroy(),super.destroy()}}class k extends o.Physics.Arcade.Sprite{constructor(e,t,i,s){super(e,t,i,"xp"),e.add.existing(this),e.physics.add.existing(this),this.xpValue=s,this.collected=!1,this.attractRadius=150,e.tweens.add({targets:this,scale:{from:.8,to:1.2},duration:500,yoyo:!0,repeat:-1})}update(e){if(this.collected)return;if(o.Math.Distance.Between(this.x,this.y,e.x,e.y)<this.attractRadius){const i=o.Math.Angle.Between(this.x,this.y,e.x,e.y),s=300;this.setVelocity(Math.cos(i)*s,Math.sin(i)*s)}else this.setVelocity(0,0)}collect(e){this.collected||(this.collected=!0,e.gainXP(this.xpValue),this.scene.tweens.add({targets:this,scale:0,alpha:0,duration:200,onComplete:()=>{this.destroy()}}))}}class b extends o.Physics.Arcade.Sprite{constructor(e,t,i){super(e,t,i,"bullet"),this.lifespan=0,this.speed=0,this.damage=0}fire(e,t,i){this.setActive(!0),this.setVisible(!0),this.speed=t.projectileSpeed,this.damage=t.damage+i,this.lifespan=t.range/t.projectileSpeed*1e3,this.setRotation(e),this.setVelocity(Math.cos(e)*this.speed,Math.sin(e)*this.speed),this.scene.time.delayedCall(this.lifespan,()=>{this.destroy()})}preUpdate(e,t){super.preUpdate(e,t)}}class T extends o.Physics.Arcade.Group{constructor(e){super(e.physics.world,e),this.createMultiple({classType:b,frameQuantity:50,active:!1,visible:!1,key:"bullet"})}fireBullet(e,t,i,s,a){const r=this.getFirstDead(!1);r&&r.fire(i,s,a)}}class O extends o.Scene{constructor(){super({key:"GameScene"})}create(){this.score=0,this.wave=1,this.gameTime=0,this.isPaused=!1,this.physics.world.setBounds(0,0,h.width,h.height),this.player=new B(this,h.width/2,h.height/2),this.bullets=new T(this),this.enemies=this.physics.add.group(),this.xpGems=this.physics.add.group(),this.physics.add.overlap(this.bullets,this.enemies,this.bulletHitEnemy,null,this),this.physics.add.overlap(this.player,this.xpGems,this.collectXP,null,this),this.createUI(),this.startWave(),this.time.addEvent({delay:1e3,callback:()=>{this.gameTime++,this.updateTimeText()},loop:!0})}update(e,t){this.isPaused||(this.player.active&&this.player.update(e,this.enemies),this.enemies.getChildren().forEach(i=>{i.active&&i.update(e,this.player)}),this.xpGems.getChildren().forEach(i=>{i.active&&i.update(this.player)}),this.updateUI())}createUI(){this.healthBarBg=this.add.graphics(),this.healthBarBg.fillStyle(0,.5),this.healthBarBg.fillRect(20,20,200,20),this.healthBar=this.add.graphics(),this.healthText=this.add.text(120,30,"",{font:"14px monospace",fill:"#ffffff"}).setOrigin(.5),this.xpBarBg=this.add.graphics(),this.xpBarBg.fillStyle(0,.5),this.xpBarBg.fillRect(20,50,200,10),this.xpBar=this.add.graphics(),this.levelText=this.add.text(230,55,"Lv.1",{font:"16px monospace",fill:"#00ffff"}),this.scoreText=this.add.text(h.width-20,20,"Score: 0",{font:"24px monospace",fill:"#ffff00"}).setOrigin(1,0),this.waveText=this.add.text(h.width-20,60,"Wave: 1",{font:"20px monospace",fill:"#ff8800"}).setOrigin(1,0),this.timeText=this.add.text(h.width/2,20,"00:00",{font:"24px monospace",fill:"#ffffff"}).setOrigin(.5,0)}updateUI(){const e=this.player.health/this.player.maxHealth;this.healthBar.clear(),this.healthBar.fillStyle(e>.5?65280:e>.25?16776960:16711680,1),this.healthBar.fillRect(20,20,200*e,20),this.healthText.setText(`${Math.ceil(this.player.health)}/${this.player.maxHealth}`);const t=this.player.xp/this.player.xpToNextLevel;this.xpBar.clear(),this.xpBar.fillStyle(65535,1),this.xpBar.fillRect(20,50,200*t,10),this.levelText.setText(`Lv.${this.player.level}`)}updateTimeText(){const e=Math.floor(this.gameTime/60),t=this.gameTime%60;this.timeText.setText(`${e.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`)}startWave(){this.wave%h.waves.bossInterval===0?this.spawnBoss():this.spawnWave(),this.waveText.setText(`Wave: ${this.wave}`)}spawnWave(){const e=h.waves.baseEnemyCount+(this.wave-1)*h.waves.enemyIncrement,t=["zombie","runner","tank"];for(let i=0;i<e;i++)this.time.delayedCall(i*h.waves.spawnInterval,()=>{const s=o.Utils.Array.GetRandom(t);this.spawnEnemy(s)});this.time.delayedCall(e*h.waves.spawnInterval+1e4,()=>{this.enemies.getChildren().length===0&&(this.wave++,this.startWave())})}spawnBoss(){const e=o.Math.Between(100,h.width-100),t=o.Math.Between(100,h.height-100),i=new g(this,e,t,"boss");this.enemies.add(i);const s=this.add.text(h.width/2,h.height/2,"BOSS 来袭!",{font:"64px monospace",fill:"#ff0000",stroke:"#000000",strokeThickness:8}).setOrigin(.5);this.tweens.add({targets:s,alpha:0,scale:2,duration:2e3,onComplete:()=>{s.destroy()}});const a=this.time.addEvent({delay:1e3,callback:()=>{i.active||(a.remove(),this.wave++,this.time.delayedCall(3e3,()=>{this.startWave()}))},loop:!0})}spawnEnemy(e){const t=o.Math.Between(0,3);let i,s;switch(t){case 0:i=o.Math.Between(0,h.width),s=-50;break;case 1:i=h.width+50,s=o.Math.Between(0,h.height);break;case 2:i=o.Math.Between(0,h.width),s=h.height+50;break;case 3:i=-50,s=o.Math.Between(0,h.height);break}const a=new g(this,i,s,e);this.enemies.add(a)}spawnXP(e,t,i){const s=new k(this,e,t,i);this.xpGems.add(s)}bulletHitEnemy(e,t){e.destroy(),t.takeDamage(e.damage),t.active||this.player.kills++}collectXP(e,t){t.collect(e)}addScore(e){this.score+=e,this.scoreText.setText(`Score: ${this.score}`)}showLevelUpUI(){this.isPaused=!0;const e=this.add.graphics();e.fillStyle(0,.8),e.fillRect(0,0,h.width,h.height),e.setDepth(100);const t=this.add.text(h.width/2,150,"升级!",{font:"48px monospace",fill:"#ffff00"}).setOrigin(.5).setDepth(101),i=Object.keys(h.upgrades),s=o.Utils.Array.Shuffle([...i]).slice(0,3),a=250,r=120;s.forEach((c,p)=>{const d=h.upgrades[c],l=a+p*r,n=this.add.graphics();n.fillStyle(3355443,1),n.fillRoundedRect(h.width/2-300,l-40,600,100,10),n.setDepth(101),n.setInteractive(new o.Geom.Rectangle(h.width/2-300,l-40,600,100),o.Geom.Rectangle.Contains);const u=this.add.text(h.width/2,l-10,d.name,{font:"28px monospace",fill:"#ffffff"}).setOrigin(.5).setDepth(102),x=this.add.text(h.width/2,l+20,d.description,{font:"18px monospace",fill:"#cccccc"}).setOrigin(.5).setDepth(102);n.on("pointerover",()=>{n.clear(),n.fillStyle(5592405,1),n.fillRoundedRect(h.width/2-300,l-40,600,100,10)}),n.on("pointerout",()=>{n.clear(),n.fillStyle(3355443,1),n.fillRoundedRect(h.width/2-300,l-40,600,100,10)}),n.on("pointerdown",()=>{this.player.applyUpgrade(d),e.destroy(),t.destroy(),n.destroy(),u.destroy(),x.destroy(),s.forEach((P,R)=>{}),this.isPaused=!1})})}gameOver(){this.saveGameData(),this.scene.start("GameOverScene",{score:this.score,wave:this.wave,kills:this.player.kills,time:this.gameTime})}saveGameData(){const e=this.getSaveData();this.score>e.highScore&&(e.highScore=this.score),this.player.weapons.forEach(t=>{e.unlockedWeapons.includes(t)||e.unlockedWeapons.push(t)}),localStorage.setItem("roguelikeShooterSave",JSON.stringify(e))}getSaveData(){const e=localStorage.getItem("roguelikeShooterSave");return e?JSON.parse(e):{highScore:0,unlockedWeapons:["pistol"]}}}class C extends o.Scene{constructor(){super({key:"GameOverScene"})}init(e){this.finalScore=e.score||0,this.finalWave=e.wave||1,this.finalKills=e.kills||0,this.finalTime=e.time||0}create(){const e=this.cameras.main.width,t=this.cameras.main.height;this.add.text(e/2,100,"GAME OVER",{font:"64px monospace",fill:"#ff0000",stroke:"#000000",strokeThickness:4}).setOrigin(.5);const s=220,a=50;this.add.text(e/2,s,`最终分数: ${this.finalScore}`,{font:"32px monospace",fill:"#ffff00"}).setOrigin(.5),this.add.text(e/2,s+a,`存活波次: ${this.finalWave}`,{font:"28px monospace",fill:"#ffffff"}).setOrigin(.5),this.add.text(e/2,s+a*2,`击杀数: ${this.finalKills}`,{font:"28px monospace",fill:"#ffffff"}).setOrigin(.5);const r=Math.floor(this.finalTime/60),c=this.finalTime%60;this.add.text(e/2,s+a*3,`存活时间: ${r.toString().padStart(2,"0")}:${c.toString().padStart(2,"0")}`,{font:"28px monospace",fill:"#ffffff"}).setOrigin(.5);const p=this.getSaveData();this.add.text(e/2,s+a*4+20,`历史最高分: ${p.highScore}`,{font:"24px monospace",fill:"#00ff00"}).setOrigin(.5);const d=this.add.text(e/2,t-150,"重新开始",{font:"32px monospace",fill:"#00ff00",backgroundColor:"#003300",padding:{x:20,y:10}});d.setOrigin(.5),d.setInteractive({useHandCursor:!0}),d.on("pointerover",()=>{d.setStyle({fill:"#ffffff",backgroundColor:"#00ff00"})}),d.on("pointerout",()=>{d.setStyle({fill:"#00ff00",backgroundColor:"#003300"})}),d.on("pointerdown",()=>{this.scene.start("GameScene")});const l=this.add.text(e/2,t-80,"返回菜单",{font:"24px monospace",fill:"#888888",backgroundColor:"#222222",padding:{x:15,y:8}});l.setOrigin(.5),l.setInteractive({useHandCursor:!0}),l.on("pointerover",()=>{l.setStyle({fill:"#ffffff",backgroundColor:"#444444"})}),l.on("pointerout",()=>{l.setStyle({fill:"#888888",backgroundColor:"#222222"})}),l.on("pointerdown",()=>{this.scene.start("MenuScene")})}getSaveData(){const e=localStorage.getItem("roguelikeShooterSave");return e?JSON.parse(e):{highScore:0,unlockedWeapons:["pistol"]}}}const M={type:o.AUTO,width:h.width,height:h.height,parent:"game-container",backgroundColor:"#2d2d2d",physics:{default:"arcade",arcade:{gravity:{y:0},debug:!1}},scene:[S,v,O,C]};new o.Game(M);
